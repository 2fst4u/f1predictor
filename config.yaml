# f1pred configuration
# Linted and valid YAML.

app:
  model_version: "v1.1"
  random_seed: 42
  timezone: "UTC"
  live_refresh_seconds: 600
  log_level: "WARNING"  # DEBUG, INFO, WARNING, ERROR - reduces default verbosity

paths:
  cache_dir: ".cache/f1pred"
  fastf1_cache: ".cache/fastf1"

data_sources:
  jolpica:
    base_url: "https://api.jolpi.ca/ergast/f1"
    timeout_seconds: 30
    rate_limit_sleep: 0.5
    enabled: true
  openf1:
    base_url: "https://api.openf1.org/v1"
    timeout_seconds: 30
    enabled: false  # API service outage (502) - fixed code ready when API recovers
  fastf1:
    enabled: true
  open_meteo:
    forecast_url: "https://api.open-meteo.com/v1/forecast"
    historical_weather_url: "https://archive-api.open-meteo.com/v1/era5"
    historical_forecast_url: "https://historical-forecast-api.open-meteo.com/v1/forecast"
    elevation_url: "https://api.open-meteo.com/v1/elevation"
    geocoding_url: "https://geocoding-api.open-meteo.com/v1/search"
    enabled: true
    # Unit choices for Open-Meteo (see docs for acceptable values)
    temperature_unit: "celsius"        # celsius | fahrenheit
    windspeed_unit: "kmh"              # kmh | ms | mph | kn
    precipitation_unit: "mm"           # mm | inch

caching:
  requests_cache:
    backend: "sqlite"
    expire_after:
      forecast_hours: 6
      historical_days: 30
    allowable_codes: [200, 203, 206, 300, 301, 308]
    stale_if_error: true

modelling:
  recency_half_life_days:
    base: 120  # reduced for more reactivity to recent form
    weather: 180
    team: 240  # reduced for team perf to be more current
  monte_carlo:
    draws: 5000
  features:
    include_openf1_tyres: true
    include_openf1_laps: true
    include_fastf1_fill: true
    include_circuit_elevation: true
    include_weather_ensemble: true
  targets:
    session_types: ["qualifying", "race", "sprint_qualifying", "sprint"]
  # pace_scale removed - was destroying variance in predictions
  simulation:
    noise_factor: 0.15
    min_noise: 0.05
    max_penalty_base: 20.0
  blending:
    gbm_weight: 0.75
    baseline_weight: 0.25
    baseline_team_factor: 0.3
    baseline_driver_team_factor: 0.2
  dnf:
    alpha: 2.0
    beta: 8.0
    driver_weight: 0.6
    team_weight: 0.4
    clip_min: 0.02
    clip_max: 0.35
  ensemble:
    w_elo: 0.2
    w_bt: 0.2
    w_mixed: 0.2
    w_gbm: 0.4
    min_std: 0.05

backtesting:
  enabled: true
  seasons: "auto"
  metrics: ["spearman", "kendall", "accuracy_top3", "brier_pairwise", "crps"]
